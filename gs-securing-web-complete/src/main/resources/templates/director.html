<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>

        <link rel="stylesheet" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
		<link rel="stylesheet" href="jquery/jquery-ui.css"/>
		<link rel="stylesheet" href="css/dataTables.bootstrap.css"/>
  		<script src="js/jquery-2.1.3.min.js"></script>
  		<script src="jquery/jquery-ui.js"></script>
  		<script src="js/bootstrap.min.js"></script>
  		<script charset="utf8" src="js/jquery.dataTables.js"></script>
		
  <script charset="utf8" src="js/dataTables.bootstrap.js"></script> 
        
        <link rel="stylesheet" type="text/css" href="css/style.css"/>

</head>

<body>
<div style="position: absolute; top:0px; left:0px; background-color:#aaa; height: 100%; width: 100%; z-index:2; opacity: 0.5; display:none;" id="hours-background"></div>
<div class="container">
	<div class="row clearfix">
		<div class="col-md-6 column">
			<h3 class="text-left text-primary" th:inline="text">
				Panel Kierownika: [[${#httpServletRequest.remoteUser}]]
			</h3>
		</div>
		
		<div class="col-md-6 column">
		<form th:action="@{/logout}" method="post">
            <input class="btn btn-danger" style="float:right; margin:3%" type="submit" value="Wyloguj"/>
        </form>
		</div>
	</div>
 <!--.......................................Panele ..............................................................-->  	
		<div class="container">
	<div class="row clearfix">
		<div class="col-md-12 column">
			<div class="tabbable" id="tabs-870073">
				<ul class="nav nav-tabs">
					<li class="active">
						<a href="#panel-493160" data-toggle="tab">Zarządzaj pracownikami</a>
					</li>
					<li>
						<a href="#panel-712304" data-toggle="tab">Wyszukaj zlecenie</a>
					</li>
					<li>
						<a href="#panel-3" data-toggle="tab">Śledz operacje w systemie</a>
					</li>
				</ul>
					
<!-- ....................................... Kalendarz!!!........................................-->  
<div class="tab-content">
	<div class="tab-pane active" id="panel-493160"> 
	
	<!--........................................Dodaj nowego uzytkownika............................................-->    
	<br></br>
	<br></br>
   
        <a href="add_account" style="text-decoration: none"><button type="button" class="btn btn-info">Dodaj nowego użytkownika</button></a>
    <!--.................................... Kalendarz.................................................. -->
	
		<h4>Wybierz pracownika z listy, aby ustalić mu dni pracy</h4>
		<select id="listOfUsers"></select>
		<input type="hidden" id="datepicker" />
		 
		<div id="datepicker-container">
				<div id="datepicker"></div>
		</div>
		<div style="position: absolute; top:20%; left:calc(50% - 200px);border-radius: 4px; padding: 11px; text-align: center; border: solid #778 2px; background-color:#fff; z-index:2; width: 400px; display:none;" id="hours-form-box">
			<form id="hours-form">
				<p>Podaj godziny pracy:</p>
				<p>
					Od: 
					<select name="from" id="from" >
						<option value="00:00:00">00:00</option>
						<option value="01:00:00">01:00</option>
						<option value="02:00:00">02:00</option>
						<option value="03:00:00">03:00</option>
						<option value="04:00:00">04:00</option>
						<option value="05:00:00">05:00</option>
						<option value="06:00:00">06:00</option>
						<option value="07:00:00">07:00</option>
						<option value="08:00:00">08:00</option>
						<option value="09:00:00">09:00</option>
						<option value="10:00:00">10:00</option>
						<option value="11:00:00">11:00</option>
						<option value="12:00:00">12:00</option>
						<option value="13:00:00">13:00</option>
						<option value="14:00:00">14:00</option>
						<option value="15:00:00">15:00</option>
						<option value="16:00:00">16:00</option>
						<option value="17:00:00">17:00</option>
						<option value="18:00:00">18:00</option>
						<option value="19:00:00">19:00</option>
						<option value="20:00:00">20:00</option>
						<option value="21:00:00">21:00</option>
						<option value="22:00:00">22:00</option>
						<option value="23:00:00">23:00</option>
						<option value="24:00:00">24:00</option>
					</select>
					<br/>
				</p>
				<p>Do: 
					<select name="to" id="to" >
						<option value="00:00:00">00:00</option>
						<option value="01:00:00">01:00</option>
						<option value="02:00:00">02:00</option>
						<option value="03:00:00">03:00</option>
						<option value="04:00:00">04:00</option>
						<option value="05:00:00">05:00</option>
						<option value="06:00:00">06:00</option>
						<option value="07:00:00">07:00</option>
						<option value="08:00:00">08:00</option>
						<option value="09:00:00">09:00</option>
						<option value="10:00:00">10:00</option>
						<option value="11:00:00">11:00</option>
						<option value="12:00:00">12:00</option>
						<option value="13:00:00">13:00</option>
						<option value="14:00:00">14:00</option>
						<option value="15:00:00">15:00</option>
						<option value="16:00:00">16:00</option>
						<option value="17:00:00">17:00</option>
						<option value="18:00:00">18:00</option>
						<option value="19:00:00">19:00</option>
						<option value="20:00:00">20:00</option>
						<option value="21:00:00">21:00</option>
						<option value="22:00:00">22:00</option>
						<option value="23:00:00">23:00</option>
						<option value="24:00:00">24:00</option>
					</select>
					<br/>
				</p>
				<p><input type="submit" value="Zapisz"/></p>
			</form>
		</div>
					<script>
					
					var selected_day;
					var selected_user;
					
					$('#hours-background').click(function(){
						hideHours();
						
					});
					
					$('#hours-form').submit(function(event){
						event.preventDefault();
						
						var $inputs = $('#hours-form :input');
						var values = {};
					    $inputs.each(function() {
					        values[this.name] = $(this).val();
					    });
						
						var parameters = {
								from : values['from'],
								to : values['to'],
								day : selected_day.prop('value'),
								username : $('#listOfUsers').val()
						};
						
						
						sendRequestForCalendarCreation(selected_day.prop('value'),true,$('#listOfUsers').val() );
						$('#datepicker').datepicker('setDate');
						//$(this).data('datepicker').inline = true;
						
						$.post('/calendar_hours_create', parameters, function(response){
							console.log(response);
							refreshCalendarOfUser($('#listOfUsers').val());
						});
						
						hideHours();
					});
					
					function showHours(){
						$('#hours-background').show();
						$('#hours-form-box').show();
						$.get('/calendar_working_hours', {username:selected_user, day:selected_day.prop('value')}, function(data){
							//console.log(data);
							//$.each(data,function(key,value){
								//$('#'+key).find('option[value=""'+value+'""]').attr("selected",true);
							//});
						});
					}
					
					function hideHours(){
						$('#hours-background').hide();
						$('#hours-form-box').hide();						
					}
					
					var SelectedDates = {};
					function refreshCalendarOfUser(username){
						$.get('/calendar_list', {username:username}, function(data){
							console.log("Wykonuje odswiezenie dla " + username);
							SelectedDates = {};
							$.each(data,function(i,value){
								SelectedDates[new Date(value + " 00:00:00")] = new Date(value + " 00:00:00");
							});
							$('#datepicker').datepicker("refresh");
						});
					}
					
				//	SelectedDates[new Date('2015-05-05 00:00:00')] = new Date('2015-05-05 00:00:00');
					
					$.get('/user_list', function(data){
						$.each(data,function(i,value){
							$('#listOfUsers').append('<option>'+value+'</option>'); //lista uzytkownikow
						});
						
						refreshCalendarOfUser($('#listOfUsers').val());
					});
					
					function sendRequestForCalendarCreation(day,work_day,username){
						var parameters = {
								day : day,
								work_day : work_day,
								username : username
						};
						
						$.post('/calendar_create', parameters, function(response){
							console.log(response);
							refreshCalendarOfUser($('#listOfUsers').val());
						});			
					}
										
					$( "#datepicker" ).datepicker({
						buttonImage: 'kalendarz.png',
				        buttonImageOnly: true,
				        firstDay: 1, //poniedzialek to pierwszy dzien tygodnia,
				        dayNamesMin: ["Nd", "Pn", "Wt", "Śr", "Cz", "Pt", "So" ],
				        monthNames: [ "Styczeń", "Luty", "Marzec", "Kwiecień", "Maj", "Czerwiec", "Lipiec", "Sierpień", "Wrzesień", "Październik", "Listopad", "Grudzień" ],
				        showOn: 'both',
				        dateFormat: "yy-mm-dd",
						onSelect : function(){
							//po kliknieciu zapisz do bazy
							selected_day = $(this);
							selected_user = $('#listOfUsers').val();
							showHours();
						},
						beforeShowDay: function(date) {
				            
							var Highlight = SelectedDates[date];
				            if (Highlight) {
				            	return [true, "Highlighted", 'Dzień roboczy'];
				            }
				            else {
				                return [true, '', 'Dzień wolny'];
				            }
				        },
				        onClose: function() {
				            $(this).data('datepicker').inline = false;
				        }
					});
			
					
					$('#listOfUsers').on('change', function(){
						refreshCalendarOfUser($('#listOfUsers').val());
					});
										
		</script>
</div>

<!--.......................................Sekcja wyszukiwarka..............................................................-->  
	<div class="tab-pane" id="panel-712304">
	<script th:inline="javascript">
									$(document).ready(function(){
						$.getJSON('/report_full', function(result){
							$.each(result, function(index,report){ 
								$('#clientsTable tbody').append('<tr class="warning"><td><input type="checkbox" value="'+report.task.id+'"></input>'+report.task.id+'</td><td>'+report.client.numberPlate+'</td><td>'+
										report.client.firstName + " " + report.client.lastName+'</td><td>'+report.task.title+'</td><td>'+report.task.description+'</td><td>'+report.task.hours+'</td><td>'+report.task.date+'</td><td>'+report.task.mechanic+'</td><td>'+report.task.repairCosts+'</td><td>'+
										report.task.partsCosts+'</td><td>'+report.cost+'</td><td>'+(report.task.isDone ? 'Zrealizowano' : 'W trakcie')+'</td></tr>')
							});
							$('#clientsTable').dataTable(
									{
										"sPaginationType": "simple",
								        "language": {
								            "lengthMenu": "Wyświetl _MENU_ wyników na każdej stronie",
								            "zeroRecords": "Brak rekordów",
								            "info": "Wyświetlam stronę _PAGE_ z _PAGES_",
								            "infoEmpty": "Brak rekordów",
								            "search": "Szukaj",
								            "infoFiltered": "(Dostępnych _MAX_ wszystkich rekordów)"
								        }});
							$('tr[name=client-row]').click(function(row){
								$(this).find('input').prop('checked', true);
								$('tr[name=client-row]').each(function(){
									$(this).switchClass("success", "warning");
								});
								$(this).switchClass("warning", "success");
							});
						});
						
					});
			
		</script>
		

		<!--..................................Aktywne zadania mechanika..........................................-->
			<div class="container">
				<div class="row clearfix">
					<div id="reporttab" class="col-md-12 column">
						<table id="clientsTable" class="table table-hover">
							<thead>
								<tr>
									<th>Numer Ew.</th>
									<th>Nr. Rej.</th>
									<th>Klient</th>
									<th>Tytuł</th>
									<th>Opis</th>
									<th>Godziny</th>
									<th>Data</th>
									<th>Mechanik</th>
									<th>Naprawa</th>
									<th>Części</th>
									<th>Koszt</th>
									<th>Status</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>		
	
	
</div>

<!--.......................................Sekcja Zaawansowane śledzenie..............................................................-->  
	<div class="tab-pane" id="panel-3">
						
	
<script th:inline="javascript">
									$(document).ready(function(){
						$.getJSON('/logs', function(result){
							$.each(result, function(index,logs){ 
								$('#logs tbody').append('<tr class="warning"><td>'+logs.date+'</td><td>'+logs.action+'</td></tr>')
							});
							$('#logs').dataTable(
									{
										"sPaginationType": "simple",
								        "language": {
								            "lengthMenu": "Wyświetl _MENU_ wyników na każdej stronie",
								            "zeroRecords": "Brak rekordów",
								            "info": "Wyświetlam stronę _PAGE_ z _PAGES_",
								            "infoEmpty": "Brak rekordów",
								            "search": "Szukaj",
								            "infoFiltered": "(Dostępnych _MAX_ wszystkich rekordów)"
								        }});
						
						});
						
					});
			
		</script>
		

		<!--..................................Akywnosci w systemie..........................................-->
			<div class="container">
				<div class="row clearfix">
					<div id="reporttab" class="col-md-12 column">
						<table id="logs" class="table table-hover">
							<thead>
								<tr>
									<th>Czas</th>
									<th>Aktywność</th>
									
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>		

	
</div>
								
				</div>
			</div>
		</div>
	</div>
</div>
</div>


        
    </body>
</html>