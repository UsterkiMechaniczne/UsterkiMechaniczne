<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
    <head>
        <title>Konto użytkownika</title>
        <link rel="stylesheet" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
		<link rel="stylesheet" href="jquery/jquery-ui.css"/>
  		<script src="js/jquery-2.1.3.min.js"></script>
  		<script src="jquery/jquery-ui.js"></script>
		<script src="js/bootstrap.min.js"></script>
        
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
        
    </head>
    <body>
        <h1 th:inline="text">Witaj [[${#httpServletRequest.remoteUser}]]!</h1>
        <h2 th:inline="text">Jesteś zalogowany jako: [[${#httpServletRequest.userPrincipal.authorities[0]}]]</h2>
        
<!-- ....................................... Kalendarz!!!........................................-->   
		<h4>Wybierz pracownika z listy, aby ustalić mu dni wolne od pracy</h4>
		<select id="listOfUsers"></select>
		<input type="hidden" id="datepicker" />
		
		<!-- Ustawienie koloru tła komórki -->
		 
		<div id="datepicker-container">
				<div id="datepicker"></div>
		</div>
					<script>
					
					var SelectedDates = {};
					function refreshCalendarOfUser(username){
						$.get('/calendar_list', {username:username}, function(data){
							SelectedDates = {};
							$.each(data,function(i,value){
								SelectedDates[new Date(value + " 00:00:00")] = new Date(value + " 00:00:00");
							});
						});
					}
				//	SelectedDates[new Date('2015-05-05 00:00:00')] = new Date('2015-05-05 00:00:00');
					
					$.get('/user_list', function(data){
						$.each(data,function(i,value){
							$('#listOfUsers').append('<option>'+value+'</option>'); //lista uzytkownikow
						});
						
						refreshCalendarOfUser($('#listOfUsers').val());
					});
					
					function sendRequestForCalendarCreation(day,work_day,username){
						var parameters = {
								day : day,
								work_day : work_day,
								username : username
						};
						
						$.post('/calendar_create', parameters, function(response){
							console.log(response);
						});			
					}
					
					$( "#datepicker" ).datepicker({
						buttonImage: 'kalendarz.png',
				        buttonImageOnly: true,
				        showOn: 'both',
				        dateFormat: "yy-mm-dd",
						onSelect : function(){
							//po kliknieciu zapisz do bazy
							sendRequestForCalendarCreation($(this).prop('value'),false,$('#listOfUsers').val() );
							refreshCalendarOfUser($('#listOfUsers').val());
						},
						beforeShowDay: function(date) {
				            var Highlight = SelectedDates[date];
				            if (Highlight) {
				            	return [true, "Highlighted", 'Dzień wolny.'];
				            }
				            else {
				                return [true, '', ''];
				            }
				        }
					});
			
					
					$('#listOfUsers').on('change', function(){
						refreshCalendarOfUser($('#listOfUsers').val());
					});
		</script>
<!--..............................................................................................-->    
   
        <a href="add_account" style="text-decoration: none"><button type="button">Dodaj nowego użytkownika</button></a>
        <form th:action="@{/logout}" method="post">
            <input type="submit" value="Wyloguj"/>
        </form>
        
    </body>
</html>